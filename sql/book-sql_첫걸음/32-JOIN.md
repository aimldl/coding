

* Draft: 2021-04-05 (Mon)

# 32강. 테이블 결합

## 1. 곱집합과 교차결합 (Cross Join), p.285

`sample72_x` CROSS JOIN `sample72_y` -> `sample72_x, sample72_y`

```sql
mysql> SELECT * FROM sample72_x;
+------+
| x    |
+------+
| A    |
| B    |
| C    |
+------+
3 rows in set (0.05 sec)

mysql> SELECT * FROM sample72_y;
+------+
| y    |
+------+
|    1 |
|    2 |
|    3 |
+------+
3 rows in set (0.00 sec)
mysql>
```

를 교차결합하면

```sql
mysql> SELECT * FROM sample72_x, sample72_y;
+------+------+
| x    | y    |
+------+------+
| A    |    1 |
| B    |    1 |
| C    |    1 |
| A    |    2 |
| B    |    2 |
| C    |    2 |
| A    |    3 |
| B    |    3 |
| C    |    3 |
+------+------+
9 rows in set (0.00 sec)
mysql> 
```

## 2. 내부 결합 (INNER JOIN), p.288

Q: 상품 테이블 및 재고수 테이블을 결합해서 식료품의 상품명과 재고수를 알고 싶습니다. 
    결과는 아래처럼 보여집니다.

```sql
+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
```

### 상품 테이블, 재고수 테이블

`CREATE TABLE` 명령어로 만들어진 `상품`테이블과 `재고수` 테이블이 있습니다.

```sql
mysql> CREATE TABLE 상품 (
    -> 상품코드 CHAR(4) NOT NULL,
    -> 상품명 VARCHAR(30),
    -> 메이커명 VARCHAR(30),
    -> 가격 INTEGER,
    -> 상품분류 VARCHAR(30),
    -> PRIMARY KEY (상품코드)
    -> );
mysql> CREATE TABLE 재고수 (
    -> 상품코드 CHAR(4),
    -> 입고날짜 DATE,
    -> 재고수 INTEGER
    -> );
mysql>
```

각각의 테이블의 값을 보면

```sql
mysql> SELECT * FROM 상품;
+--------------+-----------+--------------+--------+--------------+
| 상품코드     | 상품명    | 메이커명     | 가격   | 상품분류     |
+--------------+-----------+--------------+--------+--------------+
| 0001         | 상품1     | 메이커1      |    100 | 식료품       |
| 0002         | 상품2     | 메이커2      |    200 | 식료품       |
| 0003         | 상품3     | 메이커3      |   1980 | 생활용품     |
+--------------+-----------+--------------+--------+--------------+
3 rows in set (0.00 sec)

mysql> SELECT * FROM 재고수;
+--------------+------------+-----------+
| 상품코드     | 입고일     | 재고수    |
+--------------+------------+-----------+
| 0001         | 2014-01-03 |       200 |
| 0002         | 2014-02-10 |       500 |
| 0003         | 2014-02-14 |        10 |
+--------------+------------+-----------+
3 rows in set (0.00 sec)

mysql>
```

### 내부결합한 테이블

교차결합한 테이블은

```sql
mysql> SELECT * FROM 상품, 재고수;
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
| 상품코드     | 상품명    | 메이커명     | 가격   | 상품분류     | 상품코드     | 입고일     | 재고수    |
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
| 0001         | 상품1     | 메이커1      |    100 | 식료품       | 0001         | 2014-01-03 |       200 |
| 0002         | 상품2     | 메이커2      |    200 | 식료품       | 0001         | 2014-01-03 |       200 |
| 0003         | 상품3     | 메이커3      |   1980 | 생활용품     | 0001         | 2014-01-03 |       200 |
| 0001         | 상품1     | 메이커1      |    100 | 식료품       | 0002         | 2014-02-10 |       500 |
| 0002         | 상품2     | 메이커2      |    200 | 식료품       | 0002         | 2014-02-10 |       500 |
| 0003         | 상품3     | 메이커3      |   1980 | 생활용품     | 0002         | 2014-02-10 |       500 |
| 0001         | 상품1     | 메이커1      |    100 | 식료품       | 0003         | 2014-02-14 |        10 |
| 0002         | 상품2     | 메이커2      |    200 | 식료품       | 0003         | 2014-02-14 |        10 |
| 0003         | 상품3     | 메이커3      |   1980 | 생활용품     | 0003         | 2014-02-14 |        10 |
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
9 rows in set (0.00 sec)

mysql> 
```

### 내부결합한 테이블에 대한 SELECT문

내용을 보면 상품코드가 2개 열에 있고, 상품코드가 동일하지 않은 경우가 있습니다. 에러를 방지하기 위해 우선 각 상품코드가 동일한 경우를 확인합니다.

```sql
mysql> SELECT * FROM 상품, 재고수 WHERE 상품.상품코드=재고수.상품코드;
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
| 상품코드     | 상품명    | 메이커명     | 가격   | 상품분류     | 상품코드     | 입고일     | 재고수    |
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
| 0001         | 상품1     | 메이커1      |    100 | 식료품       | 0001         | 2014-01-03 |       200 |
| 0002         | 상품2     | 메이커2      |    200 | 식료품       | 0002         | 2014-02-10 |       500 |
| 0003         | 상품3     | 메이커3      |   1980 | 생활용품     | 0003         | 2014-02-14 |        10 |
+--------------+-----------+--------------+--------+--------------+--------------+------------+-----------+
3 rows in set (0.00 sec)

mysql> 
```

이 중에 상품명과 재고수만 발췌하면 아래와 같습니다.

```sql
mysql> SELECT 상품명,재고수 FROM 상품, 재고수 WHERE 상품.상품코드=재고수.상품코드;
+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
| 상품3     |        10 |
+-----------+-----------+
3 rows in set (0.00 sec)

mysql> 
```

### 정답: `식료품`의 상품명과 재고수

`식료품`의 상품명과 재고수를 알고 싶으므로 아래 명령어를 실행합니다.

```sql
mysql> SELECT 상품.상품명, 재고수.재고수 FROM 상품, 재고수 WHERE 상품.상품코드=재고수.상품코드 AND 상품.상품분류='식료품';
+-----------+-----------+
| 상품명    | 재고수    |+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
2 rows in set (0.00 sec)

mysql>
```

## 3. INNER JOIN으로 내부결합하기, p.294

동일한 결과를 `INNER JOIN`으로 결합하고 WHERE 대신 ON, AND 대신 WHERE를 써서 얻을 수 있습니다.

```sql
mysql> SELECT 상품.상품명, 재고수.재고수 FROM 상품 INNER JOIN 재고수 ON 상품.상품코드=재고수.상품코드 WHERE 상품.상품분류='식료품';
+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
2 rows in set (0.00 sec)

mysql>
```

### alias의 사용

동일한 결과를 얻는 명령어에서 테이블의 alias를 사용한 예입니다.

```sql
mysql> SELECT S.상품명, J.재고수 FROM 상품 S INNER JOIN 재고수 J ON S.상품코드=J.상품코드 WHERE S.상품분류='식료품';
+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
2 rows in set (0.00 sec)

mysql> 
```

## 4. 내부결합을 활용한 데이터 관리, p.295

```sql
CREATE TABLE 메이커 (
    메이커코드 CHAR(4) NOT NULL,
    메이커명 VARCHAR(30),
    PRIMARY KEY (메이커코드)
);   
```

```sql
mysql> SELECT * FROM 메이커;
+-----------------+--------------+
| 메이커코드      | 메이커명     |
+-----------------+--------------+
| M001            | 메이커1      |
| M002            | 메이커2      |
+-----------------+--------------+
2 rows in set (0.00 sec)

mysql> 
```

`INNER JOIN`을 함에 있어서 내부결합된 테이블의 기본키가 일치하는 결과를 원하므로 

```sql
SELECT * FROM TABLE1 S INNER JOIN TABLE2 M ON S.메이커코드=M.메이커코드
```

형태의 명령어가 구성됩니다. 

예제7-12, p.297

```sql
mysql> SELECT S.상품명, M.메이커명 FROM 상품2 S INNER JOIN 메이커 M ON S.메이커코드=M.메이커코드;
+-----------+--------------+
| 상품명    | 메이커명     |
+-----------+--------------+
| 상품1     | 메이커1      |
| 상품2     | 메이커1      |
| 상품3     | 메이커2      |
+-----------+--------------+
3 rows in set (0.00 sec)

mysql>
```

예제 7-13. 상품 테이블을 자기결합하기, p.299

```sql
mysql> SELECT S1.상품명, S2.상품명 FROM 상품 S1 INNER JOIN 상품 S2 ON S1.상품코드=S2.상품코드;
+-----------+-----------+
| 상품명    | 상품명    |
+-----------+-----------+
| 상품1     | 상품1     |
| 상품2     | 상품2     |
| 상품3     | 상품3     |
+-----------+-----------+
3 rows in set (0.00 sec)

mysql> 
```

## 5. 외부결합 (LEFT JOIN)

**예제 7-14. 내부결합에서는 상품코드가 0009인 상품이 제외**

```sql
mysql> SELECT 상품3.상품명, 재고수.재고수 FROM 상품3 INNER JOIN 재고수 ON 상품3.상품코드=재고수.상품코드 WHERE 상품3.상품분류='식료품';
+-----------+-----------+
| 상품명    | 재고수    |
+-----------+-----------+
| 상품1     |       200 |
| 상품2     |       500 |
+-----------+-----------+
2 rows in set (0.00 sec)

mysql>
```

**예제 7-15. 외부결합으로 상품코드 0009인 상품도 결과에 포함**

```sql
asdf
```

